{"ast":null,"code":"var _jsxFileName = \"/home/david/Desktop/workSpace/bots-dashboard/src/pages/Phone.js\",\n    _s = $RefreshSig$();\n\nimport { useEffect, useState, useRef } from 'react';\nimport { register } from './utils';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction Phone(props) {\n  _s();\n\n  const [ua, setUa] = useState(null);\n  const [connecting, setConnecting] = useState(false);\n  const [critical, setCritical] = useState(false);\n  const [sipStatus, setSipStatus] = useState('');\n  const [incomingCall, setIncomingCall] = useState(null);\n  const [session, setSession] = useState(null);\n  const audioRef = useRef();\n  useEffect(() => {\n    setConnecting(true);\n    register('200-dataocean', 'RjH2TV2s9s8FHSpz', userAgent => {\n      setUa(userAgent);\n    });\n    return () => {\n      if (ua) {\n        ua.stop();\n      }\n    }; // eslint-disable-next-line\n  }, []);\n  useEffect(() => {\n    if (ua) {\n      ua.on('registered', () => {\n        setConnecting(false);\n        setCritical(false);\n      });\n      ua.on('registrationFailed', () => {\n        setConnecting(false);\n        setCritical(true);\n      });\n      ua.on('newRTCSession', e => {\n        const callSession = e.session;\n        console.log(callSession._direction);\n\n        if (callSession._direction === 'incoming') {\n          setSession(callSession);\n          callSession.on('accepted', () => {\n            setupRemoteMedia(callSession);\n            setSipStatus('inbound accepted');\n          });\n          callSession.on('failed', () => {\n            setSipStatus('inbound failed');\n            setIncomingCall(null);\n          });\n          callSession.on('ended', () => {\n            cleanupMedia();\n            setSipStatus('inbound ended');\n            setIncomingCall(null);\n          });\n        }\n      });\n    }\n  }, [ua]);\n\n  const setupRemoteMedia = session => {\n    setSession(session);\n    session.connection.addEventListener('addstream', e => {\n      let player = audioRef.current;\n      player.srcObject = e.stream;\n      player.play();\n    });\n  };\n\n  const cleanupMedia = () => {\n    let player = audioRef.current;\n    player.srcObject = null;\n    player.pause();\n  };\n\n  const makeCall = phone => {\n    let eventHandlers = {\n      'connecting': e => {\n        console.log('call is in progress');\n        setSipStatus('connecting');\n      },\n      'progress': e => {\n        console.log('call is in progress');\n        setSipStatus(\"progress\");\n      },\n      'failed': e => {\n        console.log('call failed with cause: ', e);\n        cleanupMedia();\n        setSipStatus(\"failed\");\n      },\n      'ended': e => {\n        console.log('call ended with cause: ', e);\n        cleanupMedia();\n        setSipStatus(\"ended\");\n      },\n      'confirmed': e => {\n        setSipStatus(\"confirmed\");\n      }\n    };\n    let options = {\n      eventHandlers: eventHandlers,\n      mediaConstraints: {\n        'audio': true,\n        'video': false\n      }\n    };\n    let session = ua.call('sip:0534217014@webrtc.1com.co.il', options);\n    setupRemoteMedia(session);\n  };\n\n  const answerCall = () => {\n    if (incomingCall) {\n      incomingCall.answer({\n        mediaConstraints: {\n          'audio': true,\n          'video': false\n        }\n      });\n      setSipStatus('accepted');\n    }\n  };\n\n  const rejectCall = () => {\n    if (incomingCall) {\n      incomingCall.terminate();\n      setIncomingCall(null);\n      setSipStatus('rejected');\n    }\n  };\n\n  console.log({\n    session\n  });\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [connecting ? 'connecting' : '', critical ? 'error' : '', \"Sip status : \", sipStatus, \" \", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 38\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: makeCall,\n      children: \"call\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: () => session.terminate(),\n      children: \"end call\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 19\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 25\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: () => session.mute(),\n      children: \"mute\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: () => session.unmute(),\n      children: \"unmute\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 19\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 25\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: () => session.hold(),\n      children: \"hold\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: () => session.unhold(),\n      children: \"unhold\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 19\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 25\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: () => session.answer(),\n      children: \"answer\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: () => session.sendDTMF(2),\n      children: \"2\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'none'\n      },\n      children: /*#__PURE__*/_jsxDEV(\"audio\", {\n        controls: true,\n        ref: audioRef,\n        children: \"Your browser does not support the audio element.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 138,\n    columnNumber: 9\n  }, this);\n}\n\n_s(Phone, \"jbfHFQnv9i/5+PU1qc7NlQ/+G/M=\");\n\n_c = Phone;\nexport default Phone;\n\nvar _c;\n\n$RefreshReg$(_c, \"Phone\");","map":{"version":3,"names":["useEffect","useState","useRef","register","Phone","props","ua","setUa","connecting","setConnecting","critical","setCritical","sipStatus","setSipStatus","incomingCall","setIncomingCall","session","setSession","audioRef","userAgent","stop","on","e","callSession","console","log","_direction","setupRemoteMedia","cleanupMedia","connection","addEventListener","player","current","srcObject","stream","play","pause","makeCall","phone","eventHandlers","options","mediaConstraints","call","answerCall","answer","rejectCall","terminate","mute","unmute","hold","unhold","sendDTMF","display"],"sources":["/home/david/Desktop/workSpace/bots-dashboard/src/pages/Phone.js"],"sourcesContent":["import { useEffect, useState, useRef } from 'react';\nimport { register } from './utils';\n\n\nfunction Phone(props) {\n    const [ua, setUa] = useState(null);\n    const [connecting, setConnecting] = useState(false);\n    const [critical, setCritical] = useState(false);\n    const [sipStatus, setSipStatus] = useState('');\n    const [incomingCall, setIncomingCall] = useState(null);\n    const [session, setSession] = useState(null);\n\n    const audioRef = useRef();\n\n    useEffect(() => {\n        setConnecting(true);\n        register('200-dataocean', 'RjH2TV2s9s8FHSpz', (userAgent) => {\n            setUa(userAgent);\n        });\n\n        return () => {\n            if (ua) {\n                ua.stop();\n            }\n        };\n        // eslint-disable-next-line\n    }, []);\n\n    useEffect(() => {\n        if (ua) {\n            ua.on('registered', () => {\n                setConnecting(false);\n                setCritical(false);\n            });\n\n            ua.on('registrationFailed', () => {\n                setConnecting(false);\n                setCritical(true);\n            });\n\n            ua.on('newRTCSession', (e) => {\n                const callSession = e.session;\n                console.log(callSession._direction);\n\n                if (callSession._direction === 'incoming') { \n\n                    setSession(callSession);\n\n                    callSession.on('accepted', () => {\n                        setupRemoteMedia(callSession);\n                        setSipStatus('inbound accepted');\n                    });\n    \n                    callSession.on('failed', () => {\n                        setSipStatus('inbound failed');\n                        setIncomingCall(null);\n                    });\n    \n                    callSession.on('ended', () => {\n                        cleanupMedia();\n                        setSipStatus('inbound ended');\n                        setIncomingCall(null);\n                    });\n                }\n            });\n        }\n    }, [ua]);\n\n    const setupRemoteMedia = (session) => {\n        setSession(session);\n        session.connection.addEventListener('addstream', (e) => {\n            let player = audioRef.current;\n            player.srcObject = e.stream\n            player.play();\n        })\n    }\n\n    const cleanupMedia = () => {\n        let player = audioRef.current;\n        player.srcObject = null;\n        player.pause();\n    }\n\n    const makeCall = (phone) => {\n        let eventHandlers = {\n            'connecting': (e) => {\n                console.log('call is in progress')\n                setSipStatus('connecting')\n            },\n            'progress': (e) => {\n                console.log('call is in progress')\n                setSipStatus(\"progress\")\n            },\n            'failed': (e) => {\n                console.log('call failed with cause: ', e)\n                cleanupMedia()\n                setSipStatus(\"failed\")\n            },\n            'ended': (e) => {\n                console.log('call ended with cause: ', e)\n                cleanupMedia()\n                setSipStatus(\"ended\")\n            },\n            'confirmed': (e) => {\n                setSipStatus(\"confirmed\")\n            }\n        }\n\n        let options = {\n            eventHandlers: eventHandlers,\n            mediaConstraints: { 'audio': true, 'video': false }\n        }\n        let session = ua.call('sip:0534217014@webrtc.1com.co.il', options);\n        setupRemoteMedia(session);\n    }\n\n    const answerCall = () => {\n        if (incomingCall) {\n            incomingCall.answer({\n                mediaConstraints: { 'audio': true, 'video': false },\n            });\n\n            setSipStatus('accepted');\n        }\n    }\n\n    const rejectCall = () => {\n        if (incomingCall) {\n            incomingCall.terminate();\n            setIncomingCall(null);\n            setSipStatus('rejected');\n        }\n    }\n\n    console.log({ session });\n\n    return (\n        <div>\n\n            {connecting ? 'connecting' : ''}\n\n            {critical ? 'error' : ''}\n\n            Sip status : {sipStatus} <br />\n            <button onClick={makeCall}>call</button>\n            <button onClick={() => session.terminate()}>end call</button>\n\n            <br /><br /><br />\n\n            <button onClick={() => session.mute()}>mute</button>\n            <button onClick={() => session.unmute()}>unmute</button>\n\n            <br /><br /><br />\n\n            <button onClick={() => session.hold()}>hold</button>\n            <button onClick={() => session.unhold()}>unhold</button>\n\n            <br /><br /><br />\n\n            <button onClick={() => session.answer()}>answer</button>\n\n            <button onClick={() => session.sendDTMF(2)}>2</button>\n\n            <div style={{ display: 'none' }}>\n                <audio controls ref={audioRef}>\n                    Your browser does not support the audio element.\n                </audio>\n            </div>\n        </div>\n    );\n}\n\nexport default Phone;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}