{"ast":null,"code":"var _jsxFileName = \"/home/david/Desktop/workSpace/bots-dashboard/src/pages/Phone.js\",\n    _s = $RefreshSig$();\n\nimport React, { useRef, useState } from 'react';\nimport Dialer from './DialPad';\nimport { Inviter, SessionState, UserAgent, Registerer } from \"sip.js\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst WebRtcDomain = process.env.REACT_APP_WEBRTC_DOMAIN;\n\nfunction Phone(_ref) {\n  _s();\n\n  let {\n    password,\n    ext\n  } = _ref;\n  const [call, setCall] = useState(null);\n  const audioRef = useRef();\n  const remoteStream = new MediaStream();\n\n  const playCallRingtone = () => {\n    let player = audioRef.current;\n    player.src = 'https://finance-server.com/records/ring.mp3';\n    player.loop = true;\n    player.play();\n  };\n\n  const playIncomingCallRingtone = () => {\n    let player = audioRef.current;\n    player.src = 'https://finance-server.com/records/ringtone.mp3';\n    player.loop = true;\n    player.play();\n  };\n\n  const setupRemoteMedia = session => {\n    console.log({\n      session\n    });\n    session.sessionDescriptionHandler.peerConnection.getReceivers().forEach(receiver => {\n      if (receiver.track) {\n        remoteStream.addTrack(receiver.track);\n      }\n    });\n    let player = audioRef.current;\n    player.srcObject = remoteStream;\n    player.play();\n  };\n\n  const cleanupMedia = () => {\n    let player = audioRef.current;\n    player.srcObject = null;\n    player.pause();\n    setCall(null);\n  };\n\n  const onInvite = invitation => {\n    invitation.stateChange.addListener(state => {\n      console.log(`Session state changed to ${state}`);\n\n      switch (state) {\n        case SessionState.Initial:\n          playIncomingCallRingtone();\n          break;\n\n        case SessionState.Establishing:\n          break;\n\n        case SessionState.Established:\n          setupRemoteMedia(invitation);\n          break;\n\n        case SessionState.Terminating: // fall through\n\n        case SessionState.Terminated:\n          cleanupMedia();\n          break;\n\n        default:\n          throw new Error(\"Unknown session state.\");\n      }\n    });\n    setCall(invitation); // invitation.accept();\n  };\n\n  const transportOptions = {\n    server: `wss://${WebRtcDomain}/ws` // will be in .env file\n\n  };\n  const uri = UserAgent.makeURI(`sip:${ext}-dataocean@${WebRtcDomain}`);\n  const userAgentOptions = {\n    authorizationPassword: password,\n    authorizationUsername: `${ext}-dataocean`,\n    transportOptions,\n    logBuiltinEnabled: false,\n    // if true show all sip logs\n    delegate: {\n      onInvite\n    },\n    uri\n  };\n  const userAgent = new UserAgent(userAgentOptions);\n  const registerer = new Registerer(userAgent);\n  userAgent.start().then(() => {\n    registerer.register();\n  });\n  console.log(registerer);\n\n  const makeCall = phone => {\n    playCallRingtone();\n    userAgent.start().then(() => {\n      const target = UserAgent.makeURI(`sip:${phone}@${WebRtcDomain}`);\n      const inviter = new Inviter(userAgent, target);\n      inviter.stateChange.addListener(state => {\n        console.log(`Session state changed to ${state}`);\n\n        switch (state) {\n          case SessionState.Initial:\n            break;\n\n          case SessionState.Establishing:\n            break;\n\n          case SessionState.Established:\n            setupRemoteMedia(inviter);\n            break;\n\n          case SessionState.Terminating: // fall through\n\n          case SessionState.Terminated:\n            cleanupMedia();\n            break;\n\n          default:\n            throw new Error(\"Unknown session state.\");\n        }\n      });\n      inviter.invite();\n      setCall(inviter);\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'none'\n      },\n      children: /*#__PURE__*/_jsxDEV(\"audio\", {\n        controls: true,\n        ref: audioRef,\n        children: \"Your browser does not support the audio element.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Dialer, {\n      makeCall: makeCall,\n      call: call\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 138,\n    columnNumber: 9\n  }, this);\n}\n\n_s(Phone, \"FMCg8E5RD1PqqoSRWzjwmmfIXGM=\");\n\n_c = Phone;\nexport default Phone;\n\nvar _c;\n\n$RefreshReg$(_c, \"Phone\");","map":{"version":3,"names":["React","useRef","useState","Dialer","Inviter","SessionState","UserAgent","Registerer","WebRtcDomain","process","env","REACT_APP_WEBRTC_DOMAIN","Phone","password","ext","call","setCall","audioRef","remoteStream","MediaStream","playCallRingtone","player","current","src","loop","play","playIncomingCallRingtone","setupRemoteMedia","session","console","log","sessionDescriptionHandler","peerConnection","getReceivers","forEach","receiver","track","addTrack","srcObject","cleanupMedia","pause","onInvite","invitation","stateChange","addListener","state","Initial","Establishing","Established","Terminating","Terminated","Error","transportOptions","server","uri","makeURI","userAgentOptions","authorizationPassword","authorizationUsername","logBuiltinEnabled","delegate","userAgent","registerer","start","then","register","makeCall","phone","target","inviter","invite","display"],"sources":["/home/david/Desktop/workSpace/bots-dashboard/src/pages/Phone.js"],"sourcesContent":["import React, { useRef, useState } from 'react';\nimport Dialer from './DialPad';\nimport { Inviter, SessionState, UserAgent, Registerer } from \"sip.js\";\n\nconst WebRtcDomain = process.env.REACT_APP_WEBRTC_DOMAIN;\n\n\nfunction Phone({ password, ext }) {\n    const [call, setCall] = useState(null);\n\n    const audioRef = useRef();\n\n    const remoteStream = new MediaStream();\n\n    const playCallRingtone = () => {\n        let player = audioRef.current;\n        player.src = 'https://finance-server.com/records/ring.mp3';\n        player.loop = true;\n        player.play();\n    }\n\n    const playIncomingCallRingtone = () => {\n        let player = audioRef.current;\n        player.src = 'https://finance-server.com/records/ringtone.mp3';\n        player.loop = true;\n        player.play();\n    }\n\n    const setupRemoteMedia = (session) => {\n        console.log({session});\n        session.sessionDescriptionHandler.peerConnection.getReceivers().forEach((receiver) => {\n            if (receiver.track) {\n                remoteStream.addTrack(receiver.track);\n            }\n        });\n\n        let player = audioRef.current;\n        player.srcObject = remoteStream;\n        player.play();\n    }\n\n    const cleanupMedia = () => {\n        let player = audioRef.current;\n        player.srcObject = null;\n        player.pause();\n\n        setCall(null);\n    }\n\n    const onInvite = (invitation) => {\n        invitation.stateChange.addListener((state) => {\n            console.log(`Session state changed to ${state}`);\n            switch (state) {\n                case SessionState.Initial:\n                    playIncomingCallRingtone();\n                    break;\n                case SessionState.Establishing:\n                    break;\n                case SessionState.Established:\n                    setupRemoteMedia(invitation);\n                    break;\n                case SessionState.Terminating:\n                // fall through\n                case SessionState.Terminated:\n                    cleanupMedia();\n                    break;\n                default:\n                    throw new Error(\"Unknown session state.\");\n            }\n        });\n        setCall(invitation);\n        // invitation.accept();\n    }\n\n    const transportOptions = {\n        server: `wss://${WebRtcDomain}/ws` // will be in .env file\n    };\n\n    const uri = UserAgent.makeURI(`sip:${ext}-dataocean@${WebRtcDomain}`);\n\n    const userAgentOptions = {\n        authorizationPassword: password,\n        authorizationUsername: `${ext}-dataocean`,\n        transportOptions,\n        logBuiltinEnabled: false, // if true show all sip logs\n\n        delegate: {\n            onInvite\n        },\n        uri\n    };\n\n\n    const userAgent = new UserAgent(userAgentOptions);\n\n    const registerer = new Registerer(userAgent);\n\n    userAgent.start().then(() => {\n        registerer.register();\n    });\n\n    console.log(registerer);\n\n    const makeCall = (phone) => {\n        playCallRingtone();\n        userAgent.start().then(() => {\n            const target = UserAgent.makeURI(`sip:${phone}@${WebRtcDomain}`);\n    \n            const inviter = new Inviter(userAgent, target);\n    \n            inviter.stateChange.addListener((state) => {\n                console.log(`Session state changed to ${state}`);\n                switch (state) {\n                    case SessionState.Initial:\n                        break;\n                    case SessionState.Establishing:\n                        break;\n                    case SessionState.Established:\n                        setupRemoteMedia(inviter);\n                        break;\n                    case SessionState.Terminating:\n                    // fall through\n                    case SessionState.Terminated:\n                        cleanupMedia();\n                        break;\n                    default:\n                        throw new Error(\"Unknown session state.\");\n                }\n            });\n    \n            inviter.invite();\n            setCall(inviter)\n        });\n    }\n\n\n    return (\n        <div>\n\n            <div style={{ display: 'none' }}>\n                <audio controls ref={audioRef}>\n                    Your browser does not support the audio element.\n                </audio>\n            </div>\n\n            <Dialer makeCall={makeCall} call={call}/>\n\n        </div>\n    );\n}\n\nexport default Phone;"],"mappings":"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"},"metadata":{},"sourceType":"module"}